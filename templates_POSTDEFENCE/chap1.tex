\chapter{Introduction}



	Utilizing sequential data assimilation techniques to filter the output of hydrologic models is an efficient way to correct and calibrate hydrologic models before and after their implementation in scientific studies or public projects \cite{Reichle2002}, \cite{Moradkhani2005}, \cite{Reichle2008}. Observations such as SWE (snow water equivalent), streamflow, and precipitation are collected on a daily basis across various geographic regions, allowing  real time information to be dynamically ingested by the hydrologic model and inform present and future predictions. Hydrologic models allow hydrologists to better understand the catchment hierarchy and predict the response, and the need to research optimal methods of hydrologic data assimilation has been recognized \cite{Troch2003} and researched \cite{Liu2007}, \cite{Reichle2008}. 
	Observed hydrologic data may allow models that output streamflow or SWE states, such as rainfall-runoff models, to undergo parameter estimation. Many empirical parameters exist in conceptual hydrologic models, such as the HBV model, to account for wildcard environmental attributes such as the temperature threshold for melting snow in a snowpack system \cite{Maneta2008}, the percolation of water from the upper to the lower reservoir of a groundwater system \cite{Maneta2008}, or the dispersion of a wave through a channel used in the Muskingham-Cunge routing method \cite{Montero2016}. These parameters are frequently correlated and can have more then one set of values that produce good results \cite{Jakeman1993}, \cite{Maneta2008}. Parameter estimation for rainfall-runoff models has been an active area of research \cite{Sorooshian1980},\cite{Sorooshian1993} and research has progressed into the 21st century \cite{Moradkhani2005}, \cite{Wagener2006}, \cite{Reichle2008}.
	
	Models that ingest data sequentially can have their variables efficiently refined, a process henceforth referred to as 'filtering',  by a Kalman Filter, a sequential data assimilation algorithm. Kalman Filters only need the previous timestep's state estimate and covariance matrices to update the current timestep's state estimate and covariance matrices based on a new observed state. The original Kalman filter\cite{Kalman1960} was created for applications on linear systems and adaptations are necessary for applications to non-linear systems. The extended Kalman Filter\cite{Jazwinski1970} works for mildly non-linear systems but does not function optimally on strongly non-linear systems\cite{Miller1994}. The Unscented Kalman Filter\cite{Julier1997} is an improvement on the Extended Kalman Filter that allows for the filtering of highly non-linear systems by using weighted samples from the state distribution. The Ensemble Kalman Filter\cite{Evensen1994}, a predecessor to the Unscented Kalman Filter, filters non-linear systems by generating an 'ensemble' of model instances and adding unique noise to each instance's forcing data. An advantage of this ensemble based approach is the EnKF's capacity to approximate the complete posterior estimation of a problem without weighting the samples, resulting in a better handling of strong non-linearity. The substitution of the original Kalman Filter's error covarience matrix with an ensemble covariance matrix also allows for the efficient computation of the covariance of high dimensional state vectors.
	
	To calibrate model parameters as well as correct model states a Dual State Kalman Filter may be used as demonstrated by Moradkhani et. al in 2005 \cite{Moradkhani2005}. Dual state Kalman filters simulate parameter perturbation by adding a small unbiased and Gaussian perturbation to the model parameters . These perturbed parameters vectors are then corrected in a similar fashion to the state vectors. After this happens a second filter is run to correct the state vectors in the traditional fashion. The Dual State Ensemble Kalman Filter implemented by Moradkhani et. al\cite{Moradkhani2005} extends the Ensemble Kalman Filter into a dual state configuration and is shown to successfully predict a set of parameters and correct model predictions.
	
	An alternative method of dual parameter and state estimation that utilizes the Kalman Filter is the Joint Kalman Filter, which combines states and parameters into one vector that is calculated simultaneously without the need for a second run. Joint Ensemble Kalman Filters have been successfully implemented on hydrologic models \cite{Vrugt2005}, \cite{Xiong2019} and other models \cite{Chen2008}, but Joint Ensemble Kalman filters can suffer from "filter inbreeding" under certain circumstances \cite{HendricksFranssen2008} \cite{Wen2006}. Overall Dual Ensemble Kalman Filters have been shown to produce more accurate parameter estimations then Joint Ensemble Kalman Filters, especially in noisy situations or non-linear environments, with the major drawback of the Dual approach being its larger computational cost \cite{Mariani2005}.

\section{Aim}	
	When semidistributed hydrologic models are applied over large regions that are sparsely gauged, calibrated model parameters need to be transferred from subcatchments where parameters have been identified - such as in gauged subcatchments where observations exist - to neighboring ungaged subcatchments where observations are not known in a process generally referred to as regionalization \cite{Bloschl1995}, \cite{Merz2004}. Generally, regionalization techniques transfer information between catchments deemed to be similar in some way. Multiple methods of classifying catchments as similar include by using spatial proximity \cite{Julier1997} or through other catchment attributes such as catchment shape or topographic characteristics \cite{Peel2000}. However, the correlation of catchment attributes with catchment parameters are typically low \cite{Bardossy2007} and can result in low model performances \cite{Seibert1999}, \cite{Beldring2003}. The regionalization problem in hydrologic modeling is not solved yet and is currently an important area of research in hydrology  \cite{Bardossy2007}, \cite{Gotzinger2007}.
 
	In this paper, hierarchical modeling techniques are integrated into the Dual State Ensemble Kalman Filter's parameter perturbation equation to create a Hierarchical Dual State Ensemble Kalman Filter. A hierarchical parameter perturbation framework allows the model to account for parameters that are potentially hierarchically related. For example, streamflow wave celerity being calculated for a series of subbasins may be hierarchically related to each other because of a larger watershed or topographic feature enveloping them. To examine the Dual State Hierarchical Ensemble Kalman Filter's application to high dimensional spatially distributed raster data and geographical data the hydrologic model, a variation of a rainfall-runoff model, is implemented to predict streamflows across the state of Montana. The hydrologic model is informed by a variety of sub-components featuring high dimensional spatially distributed parameters, including a snowpack process, soil process, and a Muskingham-Cunge routing component. The hydrologic model's parameters can be linked to individual sub-basins with can in turn be sorted into hydrologic unit code watershed boundaries.
	
	Chapter 2 covers the methods behind the Dual State Hierarchical Ensemble Kalman Filtering algorithm. Chapter 3 discusses the hydrologic model and how a Dual State Hierarchical Ensemble Kalman Filter was applied to it. Chapter 4 presents results while Chapter 5 discusses conclusions and further research opportunities.
	
%compares those results with calibrated parameters from a Dual State Ensemble Kalman Filter as implemented by Moradkhani et al 2005.
	