\chapter{Introduction}



	Utilizing sequential data assimilation techniques to filter hydrologic models is an efficient way to correct and calibrate them both before and after implementation in the field. Observations such as SWE (snow water equivalent), streamflow, and precipitation are collected on a daily basis across various geographic regions, allowing  real time information to be dynamically ingested by the hydrologic model and inform present and future predictions. More accurate models allow hydrologists to better understand the past and predict the future, and the need to research optimal methods of hydrologic data assimilation has been recognized \cite{Troch2003} and researched \cite{Liu2007}, \cite{Reichle2008}. Observed hydrologic data may allow models, including rainfall-runoff models, to undergo parameter estimation. Parameter estimation for rainfall-runoff models has been a relevant field of research for quite a while  \cite{Sorooshian1980},\cite{Sorooshian1993} and research has progressed into the 21'st century \cite{Moradkhani2005}, \cite{Wagener2006}.
	
	Models that ingest data sequentially can have their parameters efficiently corrected by a Kalman Filter, a sequential data assimilation algorithm. Kalman Filters only need the previous timestep's state estimate, parameter estimate, and co-variance matrices to update the current timestep's state estimate, parameter estimate, and co-variance matrices. The original Kalman filter\cite{Kalman1960} was created to solve linear problems and more complicated implementations must be used to solve non-linear problems. The extended Kalman Filter\cite{Jazwinski1970} works for mildly non-linear systems but does not function optimally on heavily non-linear systems\cite{Miller1994}. The Unscented Kalman Filter\cite{Julier1997} is an all-around improvement on the Extended Kalman Filter that allows for the filtering of highly non-linear systems. The Ensemble Kalman Filter\cite{Evensen1994}, a predecessor to the Unscented Kalman Filter, filters non-linear systems by generating an 'ensemble' of model instances and adding unique noise to each model's forcing data. The main advantage of this ensemble based approach is the substitution of the original Kalman Filter's error covarience matrix with an ensemble covariance matrix, which allows for the efficient computation of the covariance of high dimensional state vectors. 
	
	To calibrate model parameters as well as model states a Dual State Kalman Filter may be used as demonstrated by Moradkhani et. al in 2005 \cite{Moradkhani2005}. Dual state Kalman filters add a small perturbation to a series of parameters that the user wishes to calibrate. These perturbed parameters vectors are then corrected in a similar fashion to the state vectors. After this happens a second filter is run to correct the state vectors in the traditional fashion. The Dual State Ensemble Kalman Filter implemented by Moradkhani et. al\cite{Moradkhani2005} extends the Ensemble Kalman Filter into a dual state configuration and is shown to successfully predict a set of parameters.
	
	An alternative method of parameter estimation that utilizes the Kalman Filter is the Joint Kalman Filter, which combines states and parameters into one vector that is calculated simultaneously without the need for a second run. Joint Ensemble Kalman Filters have been successfully implemented on hydrologic models \cite{Vrugt2005} and other models \cite{Chen2008}, but Joint Ensemble Kalman filters can suffer from "filter inbreeding" under certain circumstances \cite{HendricksFranssen2008} and introduce inconsistency in especially heterogeneous formations \cite{Wen2006}. Overall, Dual Ensemble Kalman Filters are more accurate then Joint Ensemble Kalman Filters, especially in noisy situations, with the major drawback of the Dual approach being its larger draw on computational power \cite{Mariani2005}.
	
	In this paper hierarchical modeling techniques are integrated into the Dual State Ensemble Kalman Filter's parameter perturbation equation to create a Hierarchical Dual State Ensemble Kalman Filter. A hierarchical parameter perturbation framework allows the model to account for parameters that are hierarchically related. To examine the Dual State Hierarchical Ensemble Kalman Filter's application to high dimensional spatially distributed raster data and geographical data the hydrologic model, a variation of rainfall-runoff model, is implemented to predict streamflows across the state of Montana. The hydrologic model is informed by a variety of sub-components featuring high dimensional spatially distributed parameters, including a snowpack process, soil process, and a Muskingham-Cunge routing component. Conveniently, these parameters can be linked to individual sub-basins with can in turn be sorted into HUC-4 class watersheds, which calls for a hierarchical approach. Despite the model's high-dimensional parameters, the hydrologic model is designed to be a quick and efficient model. Accordingly, a Dual State Hierarchical Ensemble Kalman Filter is an optimal calibration algorithm to calibrate this raster data because 1) the DEHnKF does not have to compute the high dimensional state covariance matrix and 2) the hydrologic model is a sequential model that could conceivably benefit from real-time parameter correction.
	
	Chapter 2 covers the methods behind the Dual State Hierarchical Ensemble Kalman Filtering algorithm. Chapter 3 discusses the hydrologic model and how a Dual State Hierarchical Ensemble Kalman Filter was applied to it. Chapter 4 discusses results while Chapter 5 compares those results with calibrated parameters from a Dual State Ensemble Kalman Filter as implemented by Moradkhani et al.
	
	
	

	